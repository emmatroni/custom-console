<!-- BOTTONI CONSOLE -->
<script>
  let audioSample = null;
  let audioBeat = null;
  let isSamplePlaying = false;
  let isBeatPlaying = false;
  const cmsPageNames = [
    "natura",
    "ping-pong",
    "occhiali",
    "passaporto",
    "cucina",
    "liquore",
    "spartito",
    "pianola",
    "vinile",
    "calendario",
  ];

  const MP3_SAMPLE =
    "https://raw.githubusercontent.com/emmatroni/assets-audio-plastify/main/natura-campione.mp3";
  const MP3_BEAT =
    "https://raw.githubusercontent.com/emmatroni/assets-audio-plastify/main/natura-beat.mp3";

  // SVGs bottoni
  const svgMarkup = `
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 464 215">
  <g id="bottone1">
    <rect id="BASE1" class="cls-2" x="153.5" y="100.5" width="73" height="73" rx="10" ry="10"/>
    <g id="CERCHIO1">
      <path class="cls-1 cursor-hover" d="M190,160.5c-12.96,0-23.5-10.54-23.5-23.5s10.54-23.5,23.5-23.5,23.5,10.54,23.5,23.5-10.54,23.5-23.5,23.5Z"/>
      <path class="cls-3 cursor-hover" d="M190,114c12.7,0,23,10.3,23,23s-10.3,23-23,23-23-10.3-23-23,10.3-23,23-23M190,113c-13.23,0-24,10.77-24,24s10.77,24,24,24,24-10.77,24-24-10.77-24-24-24h0Z"/>
    </g>
    <g id="PLAY1">
      <path class="cls-3 cursor-hover" d="M185.59,145.47c-.83,0-1.5-.67-1.5-1.5v-13.94c0-.83.67-1.5,1.5-1.5.26,0,.52.07.75.2l12.07,6.97c.47.27.75.76.75,1.3s-.28,1.03-.75,1.3l-12.07,6.97c-.23.13-.49.2-.75.2Z"/>
      <path class="cls-1 cursor-hover" d="M185.59,129.03c.17,0,.34.04.5.14l12.07,6.97c.67.38.67,1.35,0,1.73l-12.07,6.97c-.16.09-.33.14-.5.14-.52,0-1-.42-1-1v-13.94c0-.58.48-1,1-1M185.59,128.03h0c-1.1,0-2,.9-2,2v13.94c0,1.1.9,2,2,2,.35,0,.69-.09,1-.27l12.07-6.97c.63-.36,1-1.01,1-1.73s-.37-1.37-1-1.73l-12.07-6.97c-.31-.18-.65-.27-1-.27h0Z"/>
    </g>
  </g>
  <g id="bottone2">
    <rect id="BASE2" class="cls-2" x="226.5" y="100.5" width="73" height="73" rx="10" ry="10"/>
    <g id="CERCHIO2">
      <path class="cls-1 cursor-hover" d="M263,160.5c-12.96,0-23.5-10.54-23.5-23.5s10.54-23.5,23.5-23.5,23.5,10.54,23.5,23.5-10.54,23.5-23.5,23.5Z"/>
      <path class="cls-3 cursor-hover" d="M263,114c12.7,0,23,10.3,23,23s-10.3,23-23,23-23-10.3-23-23,10.3-23,23-23M263,113c-13.23,0-24,10.77-24,24s10.77,24,24,24,24-10.77,24-24-10.77-24-24-24h0Z"/>
    </g>
    <g id="PAUSA2">
      <g>
        <path class="cls-3 cursor-hover" d="M259.24,145.47c-1.23,0-2.24-1.06-2.24-2.36v-12.22c0-1.3,1-2.36,2.24-2.36s2.24,1.06,2.24,2.36v12.22c0,1.3-1,2.36-2.24,2.36Z"/>
        <path class="cls-1 cursor-hover" d="M259.24,129.03c.96,0,1.74.83,1.74,1.86v12.22c0,1.03-.78,1.86-1.74,1.86s-1.74-.83-1.74-1.86v-12.22c0-1.03.78-1.86,1.74-1.86M259.24,128.03c-1.51,0-2.74,1.28-2.74,2.86v12.22c0,1.58,1.23,2.86,2.74,2.86s2.74-1.28,2.74-2.86v-12.22c0-1.58-1.23-2.86-2.74-2.86h0Z"/>
      </g>
      <g>
        <path class="cls-3 cursor-hover" d="M266.76,145.47c-1.23,0-2.24-1.06-2.24-2.36v-12.22c0-1.3,1-2.36,2.24-2.36s2.24,1.06,2.24,2.36v12.22c0,1.3-1,2.36-2.24,2.36Z"/>
        <path class="cls-1 cursor-hover" d="M266.76,129.03c.96,0,1.74.83,1.74,1.86v12.22c0,1.03-.78,1.86-1.74,1.86s-1.74-.83-1.74-1.86v-12.22c0-1.03.78-1.86,1.74-1.86M266.76,128.03c-1.51,0-2.74,1.28-2.74,2.86v12.22c0,1.58,1.23,2.86,2.74,2.86s2.74-1.28,2.74-2.86v-12.22c0-1.58-1.23-2.86-2.74-2.86h0Z"/>
      </g>
    </g>
  </g>
  <g id="bottone3">
    <rect id="BASE3" class="cls-2" x="299.5" y="100.5" width="73" height="73" rx="10" ry="10"/>
    <g id="CERCHIO3">
      <path class="cls-1 cursor-hover" d="M336,160.5c-12.96,0-23.5-10.54-23.5-23.5s10.54-23.5,23.5-23.5,23.5,10.54,23.5,23.5-10.54,23.5-23.5,23.5Z"/>
      <path class="cls-3 cursor-hover" d="M336,114c12.7,0,23,10.3,23,23s-10.3,23-23,23-23-10.3-23-23,10.3-23,23-23M336,113c-13.23,0-24,10.77-24,24s10.77,24,24,24,24-10.77,24-24-10.77-24-24-24h0Z"/>
    </g>
    <g id="PLAY3">
      <path class="cls-3 cursor-hover" d="M331.59,145.47c-.83,0-1.5-.67-1.5-1.5v-13.94c0-.83.67-1.5,1.5-1.5.26,0,.52.07.75.2l12.07,6.97c.47.27.75.76.75,1.3s-.28,1.03-.75,1.3l-12.07,6.97c-.23.13-.49.2-.75.2Z"/>
      <path class="cls-1 cursor-hover" d="M331.59,129.03c.17,0,.34.04.5.14l12.07,6.97c.67.38.67,1.35,0,1.73l-12.07,6.97c-.16.09-.33.14-.5.14-.52,0-1-.42-1-1v-13.94c0-.58.48-1,1-1M331.59,128.03h0c-1.1,0-2,.9-2,2v13.94c0,1.1.9,2,2,2,.35,0,.69-.09,1-.27l12.07-6.97c.63-.36,1-1.01,1-1.73s-.37-1.37-1-1.73l-12.07-6.97c-.31-.18-.65-.27-1-.27h0Z"/>
    </g>
  </g>
  <g id="bottone4">
    <rect id="BASE4" class="cls-2" x="372.5" y="100.5" width="73" height="73" rx="10" ry="10"/>
    <g id="CERCHIO4">
      <path class="cls-1 cursor-hover" d="M409,160.5c-12.96,0-23.5-10.54-23.5-23.5s10.54-23.5,23.5-23.5,23.5,10.54,23.5,23.5-10.54,23.5-23.5,23.5Z"/>
      <path class="cls-3 cursor-hover" d="M409,114c12.7,0,23,10.3,23,23s-10.3,23-23,23-23-10.3-23-23,10.3-23,23-23M409,113c-13.23,0-24,10.77-24,24s10.77,24,24,24,24-10.77,24-24-10.77-24-24-24h0Z"/>
    </g>
    <g id="PAUSA4">
      <g>
        <path class="cls-3 cursor-hover" d="M405.24,145.47c-1.23,0-2.24-1.06-2.24-2.36v-12.22c0-1.3,1-2.36,2.24-2.36s2.24,1.06,2.24,2.36v12.22c0,1.3-1,2.36-2.24,2.36Z"/>
        <path class="cls-1 cursor-hover" d="M405.24,129.03c.96,0,1.74.83,1.74,1.86v12.22c0,1.03-.78,1.86-1.74,1.86s-1.74-.83-1.74-1.86v-12.22c0-1.03.78-1.86,1.74-1.86M405.24,128.03c-1.51,0-2.74,1.28-2.74,2.86v12.22c0,1.58,1.23,2.86,2.74,2.86s2.74-1.28,2.74-2.86v-12.22c0-1.58-1.23-2.86-2.74-2.86h0Z"/>
      </g>
      <g>
        <path class="cls-3 cursor-hover" d="M412.76,145.47c-1.23,0-2.24-1.06-2.24-2.36v-12.22c0-1.3,1-2.36,2.24-2.36s2.24,1.06,2.24,2.36v12.22c0,1.3-1,2.36-2.24,2.36Z"/>
        <path class="cls-1 cursor-hover" d="M412.76,129.03c.96,0,1.74.83,1.74,1.86v12.22c0,1.03-.78,1.86-1.74,1.86s-1.74-.83-1.74-1.86v-12.22c0-1.03.78-1.86,1.74-1.86M412.76,128.03c-1.51,0-2.74,1.28-2.74,2.86v12.22c0,1.58,1.23,2.86,2.74,2.86s2.74-1.28,2.74-2.86v-12.22c0-1.58-1.23-2.86-2.74-2.86h0Z"/>
      </g>
    </g>
  </g>
</svg>
`;
  const svgMobileMarkup = ` 
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 390 147">
            <g id="mobileBtn1">
              <g id="base1">
                <rect
                  class="fill-orange"
                  x="22.47"
                  y="76.51"
                  width="58.5"
                  height="57.99"
                  rx="10.5"
                  ry="10.5"
                />
                <path
                  class="fill-white"
                  d="M70.47,77.01c5.52,0,10,4.48,10,10v36.99c0,5.52-4.48,10-10,10h-37.5c-5.52,0-10-4.48-10-10v-36.99c0-5.52,4.48-10,10-10h37.5M70.47,76.01h-37.5c-6.07,0-11,4.93-11,11v36.99c0,6.07,4.93,11,11,11h37.5c6.07,0,11-4.93,11-11v-36.99c0-6.07-4.93-11-11-11h0Z"
                />
              </g>
              <g id="cerchio1">
                <path
                  class="fill-orange"
                  d="M50.81,126.73c-11.82,0-21.44-9.62-21.44-21.44s9.62-21.45,21.44-21.45,21.44,9.62,21.44,21.45-9.62,21.44-21.44,21.44Z"
                />
                <path
                  class="fill-white"
                  d="M50.81,84.34c11.57,0,20.94,9.38,20.94,20.94s-9.38,20.94-20.94,20.94-20.94-9.38-20.94-20.94,9.38-20.94,20.94-20.94M50.81,83.34c-12.1,0-21.94,9.84-21.94,21.94s9.84,21.94,21.94,21.94,21.94-9.84,21.94-21.94-9.84-21.94-21.94-21.94h0Z"
                />
              </g>
              <g id="next1">
                <path
                  class="fill-white"
                  d="M50.45,104.42c-.67.38-.67,1.35,0,1.73l9.59,5.54c.67.38,1.5-.1,1.5-.87v-11.08c0-.77-.83-1.25-1.5-.87l-9.59,5.54Z"
                />
                <path
                  class="fill-white"
                  d="M39.74,104.42c-.67.38-.67,1.35,0,1.73l9.59,5.54c.67.38,1.5-.1,1.5-.87v-11.08c0-.77-.83-1.25-1.5-.87l-9.59,5.54Z"
                />
              </g>
            </g>
            <g id="mobileBtn2">
              <g id="base2">
                <rect
                  class="fill-orange"
                  x="79.97"
                  y="76.51"
                  width="58.5"
                  height="57.99"
                  rx="10.5"
                  ry="10.5"
                />
                <path
                  class="fill-white"
                  d="M127.97,77.01c5.52,0,10,4.48,10,10v36.99c0,5.52-4.48,10-10,10h-37.5c-5.52,0-10-4.48-10-10v-36.99c0-5.52,4.48-10,10-10h37.5M127.97,76.01h-37.5c-6.07,0-11,4.93-11,11v36.99c0,6.07,4.93,11,11,11h37.5c6.07,0,11-4.93,11-11v-36.99c0-6.07-4.93-11-11-11h0Z"
                />
              </g>
              <g>
                <g id="cerchio2" data-name="cerchio2">
                  <path
                    class="fill-white"
                    d="M109.22,126.95c-11.83,0-21.45-9.62-21.45-21.44s9.62-21.45,21.45-21.45,21.44,9.62,21.44,21.45-9.62,21.44-21.44,21.44Z"
                  />
                  <path
                    class="fill-orange"
                    d="M109.22,84.56c11.57,0,20.94,9.38,20.94,20.94s-9.38,20.94-20.94,20.94-20.94-9.38-20.94-20.94,9.38-20.94,20.94-20.94M109.22,83.56c-12.1,0-21.94,9.84-21.94,21.94s9.84,21.94,21.94,21.94,21.94-9.84,21.94-21.94-9.84-21.94-21.94-21.94h0Z"
                  />
                </g>
                <path
                  id="play2"
                  class="fill-orange"
                  d="M117.42,104.87c.67.38.67,1.35,0,1.73l-12.11,6.99c-.67.38-1.5-.1-1.5-.87v-13.98c0-.77.83-1.25,1.5-.87l12.11,6.99Z"
                />
              </g>
            </g>
            <g id="mobileBtn3">
              <g id="base3">
                <rect
                  class="fill-orange"
                  x="137.47"
                  y="76.51"
                  width="58.5"
                  height="57.99"
                  rx="10.5"
                  ry="10.5"
                />
                <path
                  class="fill-white"
                  d="M185.47,77.01c5.52,0,10,4.48,10,10v36.99c0,5.52-4.48,10-10,10h-37.5c-5.52,0-10-4.48-10-10v-36.99c0-5.52,4.48-10,10-10h37.5M185.47,76.01h-37.5c-6.07,0-11,4.93-11,11v36.99c0,6.07,4.93,11,11,11h37.5c6.07,0,11-4.93,11-11v-36.99c0-6.07-4.93-11-11-11h0Z"
                />
              </g>
              <g id="cerchio3" data-name="cerchio3">
                <path
                  class="fill-white"
                  d="M166.72,126.95c-11.83,0-21.45-9.62-21.45-21.44s9.62-21.45,21.45-21.45,21.44,9.62,21.44,21.45-9.62,21.44-21.44,21.44Z"
                />
                <path
                  class="fill-orange"
                  d="M166.72,84.56c11.57,0,20.94,9.38,20.94,20.94s-9.38,20.94-20.94,20.94-20.94-9.38-20.94-20.94,9.38-20.94,20.94-20.94M166.72,83.56c-12.1,0-21.94,9.84-21.94,21.94s9.84,21.94,21.94,21.94,21.94-9.84,21.94-21.94-9.84-21.94-21.94-21.94h0Z"
                />
              </g>
              <g id="pausa3">
                <path
                  class="fill-orange"
                  d="M161.21,99.79c0-.96.78-1.74,1.74-1.74s1.74.78,1.74,1.74v11.43c0,.96-.78,1.74-1.74,1.74s-1.74-.78-1.74-1.74v-11.43Z"
                />
                <path
                  class="fill-orange"
                  d="M168.75,99.79c0-.96.78-1.74,1.74-1.74s1.74.78,1.74,1.74v11.43c0,.96-.78,1.74-1.74,1.74s-1.74-.78-1.74-1.74v-11.43Z"
                />
              </g>
            </g>
            <g id="mobileBtn4">
              <g id="base4">
                <rect
                  class="fill-orange"
                  x="194.97"
                  y="76.51"
                  width="58.5"
                  height="57.99"
                  rx="10.5"
                  ry="10.5"
                />
                <path
                  class="fill-white"
                  d="M242.97,77.01c5.52,0,10,4.48,10,10v36.99c0,5.52-4.48,10-10,10h-37.5c-5.52,0-10-4.48-10-10v-36.99c0-5.52,4.48-10,10-10h37.5M242.97,76.01h-37.5c-6.07,0-11,4.93-11,11v36.99c0,6.07,4.93,11,11,11h37.5c6.07,0,11-4.93,11-11v-36.99c0-6.07-4.93-11-11-11h0Z"
                />
              </g>
              <g>
                <g id="cerchio4" data-name="cerchio4">
                  <path
                    class="fill-white"
                    d="M224.22,126.95c-11.83,0-21.45-9.62-21.45-21.44s9.62-21.45,21.45-21.45,21.44,9.62,21.44,21.45-9.62,21.44-21.44,21.44Z"
                  />
                  <path
                    class="fill-orange"
                    d="M224.22,84.56c11.57,0,20.94,9.38,20.94,20.94s-9.38,20.94-20.94,20.94-20.94-9.38-20.94-20.94,9.38-20.94,20.94-20.94M224.22,83.56c-12.1,0-21.94,9.84-21.94,21.94s9.84,21.94,21.94,21.94,21.94-9.84,21.94-21.94-9.84-21.94-21.94-21.94h0Z"
                  />
                </g>
                <path
                  id="play4"
                  data-name="play4"
                  class="fill-orange"
                  d="M232.42,104.87c.67.38.67,1.35,0,1.73l-12.11,6.99c-.67.38-1.5-.1-1.5-.87v-13.98c0-.77.83-1.25,1.5-.87l12.11,6.99Z"
                />
              </g>
            </g>
            <g id="mobileBtn5">
              <g id="base5">
                <rect
                  class="fill-orange"
                  x="252.47"
                  y="76.51"
                  width="58.5"
                  height="57.99"
                  rx="10.5"
                  ry="10.5"
                />
                <path
                  class="fill-white"
                  d="M300.47,77.01c5.52,0,10,4.48,10,10v36.99c0,5.52-4.48,10-10,10h-37.5c-5.52,0-10-4.48-10-10v-36.99c0-5.52,4.48-10,10-10h37.5M300.47,76.01h-37.5c-6.07,0-11,4.93-11,11v36.99c0,6.07,4.93,11,11,11h37.5c6.07,0,11-4.93,11-11v-36.99c0-6.07-4.93-11-11-11h0Z"
                />
              </g>
              <g>
                <g id="cerchio5" data-name="cerchio5">
                  <path
                    class="fill-white"
                    d="M281.72,126.95c-11.83,0-21.45-9.62-21.45-21.44s9.62-21.45,21.45-21.45,21.44,9.62,21.44,21.45-9.62,21.44-21.44,21.44Z"
                  />
                  <path
                    class="fill-orange"
                    d="M281.72,84.56c11.57,0,20.94,9.38,20.94,20.94s-9.38,20.94-20.94,20.94-20.94-9.38-20.94-20.94,9.38-20.94,20.94-20.94M281.72,83.56c-12.1,0-21.94,9.84-21.94,21.94s9.84,21.94,21.94,21.94,21.94-9.84,21.94-21.94-9.84-21.94-21.94-21.94h0Z"
                  />
                </g>
                <g id="pausa5" data-name="pausa5">
                  <path
                    class="fill-orange"
                    d="M276.21,99.79c0-.96.78-1.74,1.74-1.74s1.74.78,1.74,1.74v11.43c0,.96-.78,1.74-1.74,1.74s-1.74-.78-1.74-1.74v-11.43Z"
                  />
                  <path
                    class="fill-orange"
                    d="M283.75,99.79c0-.96.78-1.74,1.74-1.74s1.74.78,1.74,1.74v11.43c0,.96-.78,1.74-1.74,1.74s-1.74-.78-1.74-1.74v-11.43Z"
                  />
                </g>
              </g>
            </g>
            <g id="mobileBtn6">
              <g id="base6">
                <rect
                  class="fill-orange"
                  x="309.97"
                  y="76.51"
                  width="58.5"
                  height="57.99"
                  rx="10.5"
                  ry="10.5"
                />
                <path
                  class="fill-white"
                  d="M357.97,77.01c5.52,0,10,4.48,10,10v36.99c0,5.52-4.48,10-10,10h-37.5c-5.52,0-10-4.48-10-10v-36.99c0-5.52,4.48-10,10-10h37.5M357.97,76.01h-37.5c-6.07,0-11,4.93-11,11v36.99c0,6.07,4.93,11,11,11h37.5c6.07,0,11-4.93,11-11v-36.99c0-6.07-4.93-11-11-11h0Z"
                />
              </g>
              <g id="cerchio6" data-name="cerchio6">
                <path
                  class="fill-orange"
                  d="M338.72,126.95c-11.83,0-21.45-9.62-21.45-21.44s9.62-21.45,21.45-21.45,21.44,9.62,21.44,21.45-9.62,21.44-21.44,21.44Z"
                />
                <path
                  class="fill-white"
                  d="M338.72,84.56c11.57,0,20.94,9.38,20.94,20.94s-9.38,20.94-20.94,20.94-20.94-9.38-20.94-20.94,9.38-20.94,20.94-20.94M338.72,83.56c-12.1,0-21.94,9.84-21.94,21.94s9.84,21.94,21.94,21.94,21.94-9.84,21.94-21.94-9.84-21.94-21.94-21.94h0Z"
                />
              </g>
              <g id="next6">
                <path
                  class="fill-white"
                  d="M339.59,104.64c.67.38.67,1.35,0,1.73l-9.59,5.54c-.67.38-1.5-.1-1.5-.87v-11.08c0-.77.83-1.25,1.5-.87l9.59,5.54Z"
                />
                <path
                  class="fill-white"
                  d="M350.31,104.64c.67.38.67,1.35,0,1.73l-9.59,5.54c-.67.38-1.5-.1-1.5-.87v-11.08c0-.77.83-1.25,1.5-.87l9.59,5.54Z"
                />
              </g>
            </g>
          </svg>
  `;

  // sample
  function initAudioSample() {
    if (!audioSample) {
      audioSample = new Audio(MP3_SAMPLE);
      audioSample.loop = true;

      audioSample.addEventListener("loadstart", () =>
        console.log("Audio Sample: Loading started")
      );
      audioSample.addEventListener("canplay", () =>
        console.log("Audio Sample: Ready to play")
      );
      audioSample.addEventListener("error", (e) =>
        console.error("Sample audio error:", e)
      );
      audioSample.addEventListener("ended", () => {
        isSamplePlaying = false;
        updateVisualState();
      });
    }
  }

  function playSample() {
    // pausa l'audio beat se sta suonando
    if (audioBeat && isBeatPlaying) {
      pauseBeat();
    }

    initAudioSample();

    if (audioSample && !isSamplePlaying) {
      audioSample
        .play()
        .then(() => {
          isSamplePlaying = true;
          updateVisualState();
          console.log("Audio Sample: Playing");
        })
        .catch((error) => {
          console.error("Sample playback error:", error);
        });
    }
  }

  function pauseSample() {
    if (audioSample && isSamplePlaying) {
      audioSample.pause();
      isSamplePlaying = false;
      updateVisualState();
      console.log("Audio Sample: Paused");
    }
  }

  // Beat audio functions
  function initAudioBeat() {
    if (!audioBeat) {
      audioBeat = new Audio(MP3_BEAT);
      audioBeat.loop = true;

      audioBeat.addEventListener("loadstart", () =>
        console.log("Audio Beat: Loading started")
      );
      audioBeat.addEventListener("canplay", () =>
        console.log("Audio Beat: Ready to play")
      );
      audioBeat.addEventListener("error", (e) =>
        console.error("Beat audio error:", e)
      );
      audioBeat.addEventListener("ended", () => {
        isBeatPlaying = false;
        updateVisualState();
      });
    }
  }

  function playBeat() {
    // pausa l'audio sample se sta suonando
    if (audioSample && isSamplePlaying) {
      pauseSample();
    }

    initAudioBeat();

    if (audioBeat && !isBeatPlaying) {
      audioBeat
        .play()
        .then(() => {
          isBeatPlaying = true;
          updateVisualState();
          console.log("Audio Beat: Playing");
        })
        .catch((error) => {
          console.error("Beat playback error:", error);
        });
    }
  }

  function pauseBeat() {
    if (audioBeat && isBeatPlaying) {
      audioBeat.pause();
      isBeatPlaying = false;
      updateVisualState();
      console.log("Audio Beat: Paused");
    }
  }

  // cambio style a interazione desktop
  function updateVisualState() {
    const container = document.querySelector("#console-btns");
    const containerMobile = document.querySelector("#mobileConsoleBtns");
    const orange = "#fa5004",
      white = "#ffffff";

    function setFill(element, color) {
      if (element) element.style.fill = color;
    }

    function setFillAll(elements, color) {
      elements.forEach((el) => setFill(el, color));
    }

    function applyState(elements, states) {
      Object.entries(states).forEach(([key, color]) => {
        if (Array.isArray(elements[key])) {
          setFillAll(elements[key], color);
        } else {
          setFill(elements[key], color);
        }
      });
    }

    // Desktop buttons
    if (container) {
      const desktop = {
        samplePlay: container.querySelector("#CERCHIO1 path:first-child"),
        samplePause: container.querySelector("#CERCHIO2 path:first-child"),
        beatPlay: container.querySelector("#CERCHIO3 path:first-child"),
        beatPause: container.querySelector("#CERCHIO4 path:first-child"),
        borders: [
          container.querySelector("#CERCHIO1 path:nth-child(2)"),
          container.querySelector("#CERCHIO2 path:nth-child(2)"),
          container.querySelector("#CERCHIO3 path:nth-child(2)"),
          container.querySelector("#CERCHIO4 path:nth-child(2)"),
        ],
      };

      applyState(desktop, {
        borders: white,
        samplePlay: isSamplePlaying ? orange : white,
        samplePause: isSamplePlaying ? white : orange,
        beatPlay: isBeatPlaying ? orange : white,
        beatPause: isBeatPlaying ? white : orange,
      });
    }

    // Mobile buttons
    if (containerMobile) {
      const mobile = {
        samplePlayCircle: containerMobile.querySelector(
          "#mobileBtn2 #cerchio2 path:first-child"
        ),
        samplePlayIcon: containerMobile.querySelector("#play2"),
        samplePauseCircle: containerMobile.querySelector(
          "#mobileBtn3 #cerchio3 path:first-child"
        ),
        samplePauseIcons: [...containerMobile.querySelectorAll("#pausa3 path")],
        beatPlayCircle: containerMobile.querySelector(
          "#mobileBtn4 #cerchio4 path:first-child"
        ),
        beatPlayIcon: containerMobile.querySelector("#play4"),
        beatPauseCircle: containerMobile.querySelector(
          "#mobileBtn5 #cerchio5 path:first-child"
        ),
        beatPauseIcons: [...containerMobile.querySelectorAll("#pausa5 path")],
        borders: [
          containerMobile.querySelector(
            "#mobileBtn2 #cerchio2 path:nth-child(2)"
          ),
          containerMobile.querySelector(
            "#mobileBtn3 #cerchio3 path:nth-child(2)"
          ),
          containerMobile.querySelector(
            "#mobileBtn4 #cerchio4 path:nth-child(2)"
          ),
          containerMobile.querySelector(
            "#mobileBtn5 #cerchio5 path:nth-child(2)"
          ),
        ],
      };

      applyState(mobile, {
        borders: white,
        samplePlayCircle: isSamplePlaying ? orange : white,
        samplePlayIcon: isSamplePlaying ? white : orange,
        samplePauseCircle: isSamplePlaying ? white : orange,
        samplePauseIcons: isSamplePlaying ? orange : white,
        beatPlayCircle: isBeatPlaying ? orange : white,
        beatPlayIcon: isBeatPlaying ? white : orange,
        beatPauseCircle: isBeatPlaying ? white : orange,
        beatPauseIcons: isBeatPlaying ? orange : white,
      });
    }
  }

  // INTERAZIONE BOTTONI
  function initAudioPlayer() {
    // Desktop container
    const container = document.getElementById("console-btns");
    // Mobile container
    const containerMobile = document.getElementById("mobileConsoleBtns");

    // Verifica che almeno uno dei contenitori esista
    if (!container && !containerMobile) {
      console.error(
        "Neither 'console-btns' nor 'mobile-console-btns' containers found"
      );
      return;
    }

    //  desktop btns
    if (container) {
      container.innerHTML = svgMarkup;
      setupDesktopButtons(container);
    }

    //  mobile btns
    if (containerMobile) {
      containerMobile.innerHTML = svgMobileMarkup;

      // CSS per l'SVG stesso
      const svg = containerMobile.querySelector("svg");
      if (svg) {
        console.log("SVG found:", svg);
        svg.style.display = "block";
        svg.style.position = "fixed";
        svg.style.bottom = "0";
      } else {
        console.log("SVG not found in container");
      }

      setupMobileButtons(containerMobile);
    }

    updateVisualState();

    // Preload audio after 1 second
    setTimeout(() => {
      initAudioSample();
      initAudioBeat();
    }, 1000);

    console.log("Audio Player initialized");
  }

  function setupDesktopButtons(container) {
    const bottone1 = container.querySelector("#bottone1");
    const bottone2 = container.querySelector("#bottone2");
    const bottone3 = container.querySelector("#bottone3");
    const bottone4 = container.querySelector("#bottone4");

    if (bottone1) {
      bottone1.addEventListener("click", () => {
        console.log("Play Sample clicked");
        playSample();
      });
    }

    if (bottone2) {
      bottone2.addEventListener("click", () => {
        console.log("Pause Sample clicked");
        pauseSample();
      });
    }

    if (bottone3) {
      bottone3.addEventListener("click", () => {
        console.log("Play Beat clicked");
        playBeat();
      });
    }

    if (bottone4) {
      bottone4.addEventListener("click", () => {
        console.log("Pause Beat clicked");
        pauseBeat();
      });
    }
  }

  function navigateToPreviousManual() {
    // Get current page slug from URL
    const currentPath = window.location.pathname;
    const currentSlug = currentPath.split("/").pop();

    // Find current index
    const currentIndex = cmsPageNames.indexOf(currentSlug);

    if (currentIndex === -1) {
      console.warn("Current page not found in manual list");
      // Fallback: vai all'ultimo elemento della lista
      const lastSlug = cmsPageNames[cmsPageNames.length - 1]; // "calendario"
      const basePath = currentPath.substring(0, currentPath.lastIndexOf("/"));
      const newUrl = `${window.location.origin}${basePath}/${lastSlug}`;
      window.location.href = newUrl;
      return;
    }

    // Get previous index (wrap to end if at beginning)
    const previousIndex =
      currentIndex === 0 ? cmsPageNames.length - 1 : currentIndex - 1;
    const previousSlug = cmsPageNames[previousIndex];

    // Build new URL
    const basePath = currentPath.substring(0, currentPath.lastIndexOf("/"));
    const newUrl = `${window.location.origin}${basePath}/${previousSlug}`;

    // Navigate
    window.location.href = newUrl;
  }
  function navigateToNextManual() {
    const currentPath = window.location.pathname;
    const currentSlug = currentPath.split("/").pop();

    // trova index
    const currentIndex = cmsPageNames.indexOf(currentSlug);

    if (currentIndex === -1) {
      console.warn("Current page not found in manual list");
      // Fallback: vai al primo elemento della lista
      const firstSlug = cmsPageNames[0]; // "natura"
      const basePath = currentPath.substring(0, currentPath.lastIndexOf("/"));
      const newUrl = `${window.location.origin}${basePath}/${firstSlug}`;
      window.location.href = newUrl;
      return;
    }

    // Get next index (wrap to beginning if at end)
    const nextIndex = (currentIndex + 1) % cmsPageNames.length;
    const nextSlug = cmsPageNames[nextIndex];

    // Build new URL
    const basePath = currentPath.substring(0, currentPath.lastIndexOf("/"));
    const newUrl = `${window.location.origin}${basePath}/${nextSlug}`;

    // Navigate
    window.location.href = newUrl;
  }

  // Update setupMobileButtons function to add mobileBtn6 functionality:

  function setupMobileButtons(containerMobile) {
    const mobileBtn1 = containerMobile.querySelector("#mobileBtn1");
    const mobileBtn2 = containerMobile.querySelector("#mobileBtn2");
    const mobileBtn3 = containerMobile.querySelector("#mobileBtn3");
    const mobileBtn4 = containerMobile.querySelector("#mobileBtn4");
    const mobileBtn5 = containerMobile.querySelector("#mobileBtn5");
    const mobileBtn6 = containerMobile.querySelector("#mobileBtn6");

    // Previous page navigation
    if (mobileBtn1) {
      mobileBtn1.addEventListener(
        "touchstart",
        (e) => {
          e.preventDefault();
          console.log("Previous page touched");
          navigateToPreviousManual();
        },
        { passive: false }
      );
    }

    // Audio controls
    if (mobileBtn2) {
      mobileBtn2.addEventListener(
        "touchstart",
        (e) => {
          console.log("Play Sample touched");
          playSample();
        },
        { passive: true }
      );
    }

    if (mobileBtn3) {
      mobileBtn3.addEventListener(
        "touchstart",
        (e) => {
          console.log("Pause Sample touched");
          pauseSample();
        },
        { passive: true }
      );
    }

    if (mobileBtn4) {
      mobileBtn4.addEventListener(
        "touchstart",
        (e) => {
          console.log("Play beat touched");
          playBeat();
        },
        { passive: true }
      );
    }

    if (mobileBtn5) {
      mobileBtn5.addEventListener(
        "touchstart",
        (e) => {
          console.log("Pause beat touched");
          pauseBeat();
        },
        { passive: true }
      );
    }

    // Next page navigation
    if (mobileBtn6) {
      mobileBtn6.addEventListener(
        "touchstart",
        (e) => {
          e.preventDefault();
          console.log("Next page touched");
          navigateToNextManual();
        },
        { passive: false }
      );
    }
  }

  // Auto-initialize or provide manual init
  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", initAudioPlayer);
  } else {
    initAudioPlayer();
  }

  // Export API
  window.audioPlayer = {
    playSample: playSample,
    pauseSample: pauseSample,
    playBeat: playBeat,
    pauseBeat: pauseBeat,
    isSamplePlaying: () => isSamplePlaying,
    isBeatPlaying: () => isBeatPlaying,
    init: initAudioPlayer,
  };
</script>

<!-- SOUND WAVE -->
<script>
  function initWaveform() {
    const container = document.getElementById("waveform-container");

    if (!container) {
      console.error("Element with id 'waveform-container' not found");
      return;
    }

    const BAR_COUNT = 90;
    // basato sui valori di Figma (MacBook Pro 14)
    const BASE_VIEWPORT_WIDTH = 1512;
    const BASE_VIEWPORT_HEIGHT = 982;

    let svg,
      bars = [],
      animationId,
      time = 0;
    //  array di 90 elementi (BAR_COUNT) con i dati delle "barre"
    let barData = new Array(BAR_COUNT).fill(0).map(() => ({
      current: 0,
      target: 0,
      velocity: 0,
    }));

    // variabili animazione al load
    let initialWaveActive = false;
    let initialWaveStartTime = 0;
    const INITIAL_WAVE_DURATION = 1000; // ms
    const INITIAL_WAVE_DELAY = 200; // ms

    function getResponsiveDimensions() {
      const vw = window.innerWidth;
      const vh = window.innerHeight;

      const scaleW = vw / BASE_VIEWPORT_WIDTH;
      const scaleH = vh / BASE_VIEWPORT_HEIGHT;
      const scale = Math.min(scaleW, scaleH);

      return {
        barWidth: Math.max(2, Math.round(4 * scale)),
        barSpacing: Math.max(2, Math.round(5 * scale)),
        minHeight: Math.max(2, Math.round(4 * scale)),
        maxHeight: Math.max(20, Math.round(145 * scale)),
      };
    }

    function createWaveform() {
      const dims = getResponsiveDimensions();
      const totalWidth =
        BAR_COUNT * dims.barWidth + (BAR_COUNT - 1) * dims.barSpacing;
      const centerY = dims.maxHeight / 2;

      // mi assicuro che il container della wave sia vuoto
      container.innerHTML = "";

      // SVG
      svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
      svg.setAttribute("width", totalWidth);
      svg.setAttribute("height", dims.maxHeight);
      svg.style.display = "block";
      // centra svg:
      svg.style.margin = "0 auto";

      // rettangoli
      bars = [];
      for (let i = 0; i < BAR_COUNT; i++) {
        const rect = document.createElementNS(
          "http://www.w3.org/2000/svg",
          "rect"
        );
        // X = indice × (larghezza + spaziatura)
        rect.setAttribute("x", i * (dims.barWidth + dims.barSpacing));
        rect.setAttribute("width", dims.barWidth);
        rect.setAttribute("height", dims.minHeight);
        // y centrata verticalmente
        rect.setAttribute("y", centerY - dims.minHeight / 2);
        rect.setAttribute("fill", "white");
        rect.setAttribute("stroke", "none");

        svg.appendChild(rect);
        bars.push(rect);
      }
      // aggiungo svg al container .waveform-container
      container.appendChild(svg);

      // Reset bar data for new dimensions
      barData = new Array(BAR_COUNT).fill(0).map(() => ({
        current: dims.minHeight,
        target: dims.minHeight,
        velocity: 0,
      }));

      return dims;
    }

    function generateInitialWaveHeights(dims, elapsed) {
      // converte il tempo trascorso in progresso (0-1)
      const progress = elapsed / INITIAL_WAVE_DURATION; // 0 to 1
      // fattore di velocità onda (DA REGOLARE)
      const waveSpeed = 1.2;

      // mappo ogni barra per calcolare ogni h durante l'animazione
      return barData.map((_, i) => {
        // t in cui questa barra dovrebbe attivarsi (normalizzato 0-1) / fattore di v onda
        // waveSpeed = 1.2:
        // Barra 0: 0 /90  / 1.2 = 0.000
        // Barra 10:  10 /90  / 1.2  = 0.093 etc.
        // Barra 89 / 90 / 1.2 = 0.824
        const barActivationTime = i / BAR_COUNT / waveSpeed;

        // t animazione x singola barra (20% del tempo totale) (DA REGOLARE)
        const barAnimationDuration = 0.2;
        const barTime = progress - barActivationTime;

        // se barra non è attivata o l'animazione finita
        if (barTime < 0 || barTime > barAnimationDuration) {
          return dims.minHeight; // altezza default
        }
        // Progresso (0 to 1)
        const barProgress = barTime / barAnimationDuration;
        // sin per movimento fluido
        const amplitude = Math.sin(barProgress * Math.PI);

        // Incremento (DA REGOLARE ora 10px)
        const heightIncrease = Math.max(
          3,
          Math.round(10 * Math.min(1, dims.minHeight / 4))
        );

        return dims.minHeight + amplitude * heightIncrease;
      });
    }

    function generateTargetHeights(dims) {
      // Se l'animazione iniziale è attiva
      if (initialWaveActive) {
        // calcolo il tempo trascorso
        const elapsed = Date.now() - initialWaveStartTime;
        if (elapsed < INITIAL_WAVE_DURATION) {
          return generateInitialWaveHeights(dims, elapsed);
        } else {
          // termine == tutte le barre tornano a minHeight
          initialWaveActive = false;
          return barData.map(() => dims.minHeight);
        }
      }

      const isPlaying =
        window.audioPlayer?.isSamplePlaying?.() ||
        window.audioPlayer?.isBeatPlaying?.();

      // se non suona --> minheight != 0
      if (!isPlaying) {
        return barData.map(() => dims.minHeight);
      }

      // gestione della wave irregolare
      return barData.map((_, i) => {
        // 4% di probabilità di essere a maxHeight
        if (Math.random() < 0.04) {
          return dims.maxHeight;
        }
        const randomFactor = Math.random();
        // Onda sinusoidale irregolare con rumore
        const irregularWave =
          Math.sin(time * 0.015 + i * 0.15 + Math.random() * 1.5) *
          randomFactor;
        //  caos extra (±0.3)

        const chaos = (Math.random() - 0.5) * 0.6;
        const combined = Math.abs(irregularWave + chaos);

        return (
          // altezza finale (70% max range)
          dims.minHeight + combined * (dims.maxHeight - dims.minHeight) * 0.7
        );
      });
    }

    function updateBars() {
      const dims = getResponsiveDimensions();
      const targets = generateTargetHeights(dims);
      const centerY = dims.maxHeight / 2;

      bars.forEach((bar, i) => {
        const data = barData[i];
        // applica "physics-based animation"
        // le barre si muovono verso il target con accelerazione
        //  velocità diminuisce gradualmente (0.82 = perde 18% velocità ogni frame)
        data.target = targets[i];
        data.velocity += (data.target - data.current) * 0.12;
        // fattore di smorzamento (damping)
        data.velocity *= 0.7;
        data.current += data.velocity;

        // minimo e massimo
        data.current = Math.max(
          dims.minHeight,
          Math.min(dims.maxHeight, data.current)
        );

        //crescono simmetriche dal centro
        const height = Math.round(data.current);
        bar.setAttribute("height", height);
        bar.setAttribute("y", centerY - height / 2);
      });

      time++;
      animationId = requestAnimationFrame(updateBars);
    }
    // GESTIONE INIZIO ANIMAZIONE dopo 200ms
    function startInitialWave() {
      setTimeout(() => {
        initialWaveActive = true;
        initialWaveStartTime = Date.now();
      }, INITIAL_WAVE_DELAY);
    }

    function handleResize() {
      if (animationId) {
        cancelAnimationFrame(animationId);
      }
      createWaveform();
      updateBars();
    }

    // PROBLEMA HANDLER RESIZE:
    //  se ridimensiona la finestra del browser --> evento resize si scatena centinaia di volte:
    //  --> 1 sola chiamata a handleResize() (150ms dopo che l'utente ha finito)
    let resizeTimeout;
    function debouncedResize() {
      clearTimeout(resizeTimeout);
      resizeTimeout = setTimeout(handleResize, 150);
    }

    createWaveform();
    updateBars();
    startInitialWave();

    window.addEventListener("resize", debouncedResize);

    // pulizia al termine
    return () => {
      if (animationId) {
        cancelAnimationFrame(animationId);
      }
      window.removeEventListener("resize", debouncedResize);
      clearTimeout(resizeTimeout);
    };
  }

  // initialize quando DOM pronto
  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", initWaveform);
  } else {
    initWaveform();
  }
</script>
